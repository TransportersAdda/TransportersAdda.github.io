<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transporters Adda - Post Load / View Loads</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        form { max-width: 400px; }
        input, select, button { width: 100%; padding: 10px; margin: 5px 0; }
        .load-item { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        #loads-list { max-height: 500px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>Transporters Adda - PB/HR/RJ/MP Loads</h1>
    
    <!-- Login Form -->
    <div id="login-form" style="display: block;">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button onclick="signup()">Sign Up</button>
        <button onclick="login()">Login</button>
    </div>
    
    <!-- Post Load Form -->
    <div id="post-form" style="display: none;">
        <h2>Post a Load</h2>
        <form>
            <input id="from" placeholder="From City (e.g. Ludhiana)">
            <input id="to" placeholder="To City (e.g. Jaipur)">
            <select id="state">
                <option>Punjab</option>
                <option>Haryana</option>
                <option>Rajasthan</option>
                <option>MP</option>
            </select>
            <input id="weight" placeholder="Weight (tons)">
            <input id="rate" placeholder="Rate (₹)">
            <input id="contact" placeholder="Contact Mobile">
            <button type="button" onclick="postLoad()">Post Load</button>
        </form>
    </div>
    
    <!-- Loads List -->
    <div id="loads-list">
        <h2>Today's Loads</h2>
        <div id="loads-container">Loading...</div>
    </div>
    
    <script>
        // REPLACE WITH YOUR FIREBASE CONFIG (get from Firebase Console > Project Settings > Web App)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "123456789",
            appId: "YOUR_APP_ID"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Auth State Change
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('post-form').style.display = 'block';
                loadLoads();
            } else {
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('post-form').style.display = 'none';
            }
        });
        
        // Sign Up
        function signup() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => alert('Signed up!'))
                .catch(err => alert(err.message));
        }
        
        // Login
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(err => alert(err.message));
        }
        
        // Post Load
        function postLoad() {
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const state = document.getElementById('state').value;
            const weight = document.getElementById('weight').value;
            const rate = document.getElementById('rate').value;
            const contact = document.getElementById('contact').value;
            
            db.collection('loads').add({
                from, to, state, weight, rate, contact,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                userId: auth.currentUser.uid
            }).then(() => {
                alert('Load posted!');
                loadLoads(); // Refresh list
                // Clear form
                document.querySelectorAll('#post-form input, #post-form select').forEach(el => el.value = '');
            }).catch(err => alert(err.message));
        }
        
        // Load and Display Loads
        function loadLoads() {
            db.collection('loads').orderBy('timestamp', 'desc').limit(50).get()
                .then(snapshot => {
                    const container = document.getElementById('loads-container');
                    container.innerHTML = '';
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const div = document.createElement('div');
                        div.className = 'load-item';
                        div.innerHTML = `
                            <strong>${data.from} → ${data.to} (${data.state})</strong><br>
                            Weight: ${data.weight} tons | Rate: ₹${data.rate}<br>
                            Contact: <a href="tel:+91${data.contact}">${data.contact}</a> | 
                            <a href="https://wa.me/91${data.contact}?text=Load:${data.from}-${data.to}">WhatsApp</a>
                        `;
                        container.appendChild(div);
                    });
                });
        }
    </script>
</body>
</html>
